<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Crystal Task Ball</title>
<style>
  :root{
    --bg:#000;
    --purple:#6b3ea8;
    --purple-deep:#3a1e64;
    --accent:#b38cff;
  }
  html,body{height:100%;}
  body{
    margin:0; display:grid; place-items:center; background:var(--bg); color:#eee;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    overflow:hidden;
  }

  /* --- Crystal ball scene --- */
  .scene{ position:relative; width:min(90vmin,720px); aspect-ratio:1/1; }

  .ball{
    position:absolute; inset:0; margin:auto; border-radius:50%;
    /* Dark purple crystal without bright reflections */
    background:
      radial-gradient(circle at 50% 50%, rgba(90,40,150,0.6), rgba(35,15,60,0.95) 65%, rgba(0,0,0,0.98) 100%);
    box-shadow:
      0 0 40px 10px rgba(129, 77, 255, 0.25),
      inset 0 0 160px rgba(120,60,200,0.35);
    cursor:pointer; outline:none; user-select:none;
    transition: transform .5s ease; 
  }
  .ball:hover{ transform: scale(1.02); }

  /* Subtle fog swirl */
  .fog{
    position:absolute; inset:6% 6% 6% 6%; border-radius:50%; mix-blend-mode:screen; pointer-events:none;
    background:
      radial-gradient(40% 55% at 30% 35%, rgba(180,150,255,.10), transparent 70%),
      radial-gradient(50% 35% at 70% 65%, rgba(140,110,220,.08), transparent 75%);
    filter: blur(18px) saturate(120%);
    animation: swirl 12s ease-in-out infinite alternate;
  }
  @keyframes swirl{ from{transform:translate(0,0) rotate(0)} to{transform:translate(0,-4%) rotate(2deg)} }

  /* Sparkles */
  .sparkle{ position:absolute; width:6px; height:6px; border-radius:50%;
    background: radial-gradient(circle, #fff, rgba(255,255,255,0) 65%);
    opacity:.0; filter: drop-shadow(0 0 6px rgba(200,180,255,.9));
    animation: twinkle var(--dur) linear var(--delay) infinite;
  }
  @keyframes twinkle{ 0%{opacity:0; transform:scale(.6)} 10%{opacity:.9; transform:scale(1)} 20%{opacity:0; transform:scale(.6)} 100%{opacity:0; transform:scale(.6)} }

  /* Center prompt inside the ball */
  .centerText{
    position:absolute; inset:0; display:grid; place-items:center; border-radius:50%;
    font-weight:800; letter-spacing:.06em; text-transform:uppercase;
    color:#e9ddff; text-shadow:0 0 12px rgba(180,140,255,.35);
    pointer-events:none; /* clicks pass through to ball */
  }

  /* Intense thinking animation */
  .ball.think{ animation: think 2s ease-in-out 1; }
  @keyframes think{
    0%{ box-shadow:0 0 50px 12px rgba(179,140,255,.35), inset 0 0 160px rgba(120,60,200,.35); transform:scale(1); }
    20%{ box-shadow:0 0 120px 35px rgba(179,140,255,.7), inset 0 0 260px rgba(170,110,255,.6); transform:scale(1.03); }
    40%{ box-shadow:0 0 140px 40px rgba(179,140,255,.85), inset 0 0 340px rgba(200,160,255,.8); transform:scale(1.05); }
    60%{ box-shadow:0 0 120px 35px rgba(179,140,255,.7), inset 0 0 260px rgba(170,110,255,.6); transform:scale(1.03); }
    100%{ box-shadow:0 0 50px 12px rgba(179,140,255,.35), inset 0 0 160px rgba(120,60,200,.35); transform:scale(1); }
  }

  /* --- Overlay/modal --- */
  .overlay{ position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.5); }
  .overlay.show{ display:grid; }

  .modal{ 
    width:min(90vw,720px); border-radius:16px; padding:24px; 
    background: rgba(20, 10, 30, .85);
    border:1px solid rgba(180,140,255,.25);
    box-shadow: 0 10px 30px rgba(0,0,0,.6), inset 0 0 80px rgba(120,60,200,.18);
    -webkit-backdrop-filter: blur(6px); backdrop-filter: blur(6px);
    text-align:center;
  }
  .title{ font-size: clamp(18px, 4.8vmin, 34px); font-weight:700; color:#e9ddff; margin:0 0 8px; }

  .controls{ display:flex; justify-content:center; gap:12px; flex-wrap:wrap; }
  button{ appearance:none; border:none; padding:12px 18px; border-radius:12px; cursor:pointer; font-weight:700; letter-spacing:.02em; }
  .btn-primary{ color:#0a0512; background:linear-gradient(180deg, #d8c7ff, #b38cff); box-shadow:0 6px 18px rgba(179,140,255,.35); }
  .btn-ghost{ color:#d9cfff; background:transparent; border:1px solid rgba(200,180,255,.35); }
  .btn-danger{ color:#fff; background:#a43f3f; }

  /* Timer style */
  .time{ font-variant-numeric:tabular-nums; font-size: clamp(28px, 8vmin, 64px); color:#fff; margin: 6px 0 18px; }
  .task{ font-size: clamp(16px, 2.7vmin, 22px); color:#e9ddff; margin: 6px 0 14px; }

  /* Small watermark */
  .brand{ position:fixed; right:10px; bottom:8px; font-size:12px; color:#6951a1; opacity:.6; }
</style>
</head>
<body>
  <div class="scene" aria-live="polite">
    <div class="ball" id="ball" role="button" aria-label="Crystal ball. Tap to receive a task." tabindex="0">
      <div class="fog"></div>
      <!-- Sparkles created by JS -->
      <div class="centerText" id="centerText">Touch Me</div>
    </div>
  </div>

  <!-- Overlay / Modal -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="modal" id="modal">
      <h1 class="title" id="modalTitle">Your Task</h1>
      <div class="task" id="taskText">â€¦</div>
      <div class="time" id="time">00:00</div>
      <div class="controls" id="controls">
        <button class="btn-primary" id="beginBtn">Begin</button>
        <button class="btn-ghost" id="skipBtn">Skip (2 left)</button>
        <button class="btn-ghost" id="closeBtn">Close</button>
      </div>
    </div>
  </div>

  <div class="brand">Crystal Task Ball</div>

  <!-- External chime file referenced from site root -->
  <audio id="chime" src="/chime.wav" preload="auto"></audio>

<script>
(() => {
  // ====== CONFIG: 10 tasks with fixed durations (seconds) ======
  // Edit the items below. Each label always uses its set duration.
  const TASKS = [
    { label: "Sweep the floor", seconds: 2 * 60 },
    { label: "Tidy the desk", seconds: 90 },
    { label: "Wipe kitchen counter", seconds: 75 },
    { label: "Quick stretch", seconds: 60 },
    { label: "Drink water", seconds: 45 },
    { label: "Do 10 squats", seconds: 40 },
    { label: "Take deep breaths", seconds: 30 },
    { label: "Sort 10 emails", seconds: 120 },
    { label: "Put laundry in", seconds: 110 },
    { label: "Declutter one shelf", seconds: 100 },
  ];

  // ====== Elements ======
  const ball = document.getElementById('ball');
  const overlay = document.getElementById('overlay');
  const modalTitle = document.getElementById('modalTitle');
  const taskText = document.getElementById('taskText');
  const timeText = document.getElementById('time');
  const beginBtn = document.getElementById('beginBtn');
  const closeBtn = document.getElementById('closeBtn');
  const skipBtn = document.getElementById('skipBtn');
  const chime = document.getElementById('chime');

  // ====== State ======
  let currentTask = null;
  let timerId = null;
  let remaining = 0;
  let skipLeft = 2;

  // ====== Helpers ======
  const pad = (n) => String(n).padStart(2, '0');
  const fmt = (sec) => {
    const s = Math.max(0, Math.floor(sec));
    return `${pad(Math.floor(s/60))}:${pad(s%60)}`;
  };
  const updateSkipLabel = () => {
    skipBtn.textContent = `Skip (${skipLeft} left)`;
    if (skipLeft <= 0){
      skipBtn.disabled = true; skipBtn.classList.add('btn-danger');
    }
  };

  function pickTask(){
    const idx = Math.floor(Math.random() * TASKS.length);
    return TASKS[idx];
  }

  function showTask(task){
    overlay.classList.add('show');
    overlay.setAttribute('aria-hidden','false');
    modalTitle.textContent = 'Your Task';
    taskText.textContent = `You need to ${task.label.toLowerCase()}.`;
    timeText.textContent = fmt(task.seconds);
    beginBtn.style.display = '';
    skipBtn.style.display = '';
    closeBtn.style.display = '';
    updateSkipLabel();
  }

  function showTimer(){
    overlay.classList.add('show');
    overlay.setAttribute('aria-hidden','false');
    modalTitle.textContent = 'Timer';
    beginBtn.style.display = 'none';
    skipBtn.style.display = 'none';
    closeBtn.style.display = '';
  }

  function clearTimer(){
    if (timerId){ cancelAnimationFrame(timerId); timerId = null; }
  }

  async function playChime(){
    try{ await chime.play(); }catch(e){ /* autoplay might block; ignore */ }
  }

  function startCountdown(seconds){
    remaining = seconds;
    let last = performance.now();
    function tick(now){
      const dt = Math.min(2, (now - last)/1000);
      last = now;
      remaining -= dt;
      if (remaining <= 0){
        timeText.textContent = '00:00';
        clearTimer();
        playChime();
        hideOverlay();
        return;
      }
      timeText.textContent = fmt(remaining);
      timerId = requestAnimationFrame(tick);
    }
    timerId = requestAnimationFrame(tick);
  }

  function hideOverlay(){
    clearTimer();
    overlay.classList.remove('show');
    overlay.setAttribute('aria-hidden','true');
  }

  // ====== Sparkles inside the ball ======
  function seedSparkles(n=30){
    const rect = ball.getBoundingClientRect();
    const r = rect.width/2; // circle
    for (let i=0;i<n;i++){
      const s = document.createElement('span');
      s.className = 'sparkle';
      const angle = Math.random()*Math.PI*2;
      const radius = Math.sqrt(Math.random()) * (r*0.88);
      const x = r + Math.cos(angle)*radius;
      const y = r + Math.sin(angle)*radius;
      s.style.left = `calc(${(x/r*50)}% - 3px)`;
      s.style.top  = `calc(${(y/r*50)}% - 3px)`;
      s.style.setProperty('--dur', (2 + Math.random()*3).toFixed(2) + 's');
      s.style.setProperty('--delay', (Math.random()*3).toFixed(2) + 's');
      ball.appendChild(s);
    }
  }

  // ====== Intense thinking helper ======
  function thinkFor(ms=2000, then){
    ball.classList.add('think');
    setTimeout(()=>{ ball.classList.remove('think'); then && then(); }, ms);
  }

  // ====== Interactions ======
  function requestTask(){
    if (timerId) return; // ignore while running
    // 2s intense thinking before revealing the task
    thinkFor(2000, () => {
      currentTask = pickTask();
      showTask(currentTask);
    });
  }

  ball.addEventListener('click', requestTask);
  ball.addEventListener('keydown', (e)=>{ if (e.key==='Enter' || e.key===' ') { e.preventDefault(); requestTask(); } });

  beginBtn.addEventListener('click', ()=>{
    if (!currentTask) return;
    // 2s thinking before showing the timer
    thinkFor(2000, () => { showTimer(); startCountdown(currentTask.seconds); });
  });

  skipBtn.addEventListener('click', ()=>{
    if (timerId || skipLeft <= 0) return;
    skipLeft--; updateSkipLabel();
    // quick 1s think between skips for feedback
    thinkFor(1000, () => { currentTask = pickTask(); showTask(currentTask); });
  });

  closeBtn.addEventListener('click', ()=>{ if (!timerId) hideOverlay(); });
  overlay.addEventListener('click', (e)=>{ if (e.target === overlay && !timerId) hideOverlay(); });

  // Init
  seedSparkles(36);
})();
</script>
</body>
</html>

