<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Sign Layout Preview</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Simple, Apple-like system font stack -->
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text",
        system-ui, -system-ui, "Segoe UI", sans-serif;
      background: #f5f5f7;
      color: #111111;
    }

    .app {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .top-bar {
      padding: 16px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid rgba(0, 0, 0, 0.06);
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .top-bar-title {
      font-size: 18px;
      font-weight: 600;
      letter-spacing: 0.02em;
    }

    .top-bar-controls {
      display: flex;
      gap: 12px;
      align-items: center;
      font-size: 14px;
    }

    label {
      font-size: 13px;
      color: #555;
    }

    select,
    button {
      border-radius: 999px;
      border: 1px solid rgba(0, 0, 0, 0.12);
      padding: 6px 14px;
      font-size: 13px;
      background: #ffffff;
      cursor: pointer;
      outline: none;
      transition: background 0.15s ease, box-shadow 0.15s ease,
        transform 0.05s ease;
    }

    select:focus,
    button:focus {
      box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.3);
      border-color: rgba(0, 122, 255, 0.6);
    }

    button.primary {
      background: #007aff;
      border-color: #007aff;
      color: #ffffff;
    }

    button.primary:hover {
      background: #0063cc;
    }

    button:hover:not(:disabled) {
      background: rgba(0, 0, 0, 0.02);
    }

    button:active:not(:disabled) {
      transform: translateY(1px);
    }

    button:disabled {
      opacity: 0.4;
      cursor: default;
    }

    .content {
      display: flex;
      flex: 1;
      padding: 24px;
      gap: 24px;
    }

    .sidebar {
      width: 260px;
      max-width: 100%;
      background: #ffffff;
      border-radius: 18px;
      padding: 16px 18px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.04);
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .sidebar-section-title {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #999;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-top: 8px;
    }

    .field input[type="text"] {
      border-radius: 999px;
      border: 1px solid rgba(0, 0, 0, 0.12);
      padding: 6px 12px;
      font-size: 13px;
      outline: none;
    }

    .field input[type="text"]:focus {
      box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.3);
      border-color: rgba(0, 122, 255, 0.6);
    }

    .canvas-wrapper {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .canvas-frame {
      background: #e5e5ea;
      padding: 24px;
      border-radius: 24px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.08);
      display: inline-block;
    }

    .canvas-label {
      text-align: center;
      font-size: 12px;
      color: #666;
      margin-top: 10px;
    }

    canvas {
      background: #ffffff;
      border-radius: 12px;
      display: block;
    }

    @media (max-width: 900px) {
      .content {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
      }

      .canvas-frame {
        width: 100%;
      }

      canvas {
        width: 100% !important;
        height: auto !important;
      }
    }
  </style>

  <!-- Fabric.js CDN (you can update to latest stable if needed) -->
  <script src="https://cdn.jsdelivr.net/npm/fabric@5.3.0/dist/fabric.min.js"></script>
</head>
<body>
  <div class="app">
    <header class="top-bar">
      <div class="top-bar-title">Sign Layout Preview</div>
      <div class="top-bar-controls">
        <label for="sign-size">Sign size:</label>
        <select id="sign-size">
          <option value="12x6">12" × 6"</option>
          <option value="18x9">18" × 9"</option>
          <option value="24x12" selected>24" × 12"</option>
          <option value="36x18">36" × 18"</option>
        </select>

        <button id="reset-canvas">Reset</button>
        <button id="download-png" class="primary">Download Preview</button>
      </div>
    </header>

    <main class="content">
      <aside class="sidebar">
        <div>
          <div class="sidebar-section-title">Text</div>
          <div class="field">
            <label for="text-input">New text</label>
            <input
              id="text-input"
              type="text"
              placeholder="eg. THE WILSON CABIN"
            />
          </div>
          <button id="add-text-btn" style="margin-top: 8px;">Add Text</button>
        </div>

        <div>
          <div class="sidebar-section-title">Tips</div>
          <p style="font-size: 13px; line-height: 1.4; color: #666; margin: 0;">
            • Drag text to move it<br />
            • Use corner handles to resize<br />
            • Hold Shift while dragging a corner to keep proportions if needed
          </p>
        </div>
      </aside>

      <section class="canvas-wrapper">
        <div>
          <div class="canvas-frame">
            <!-- Canvas dimensions are set via JS -->
            <canvas id="design-canvas"></canvas>
          </div>
          <div class="canvas-label" id="canvas-label"></div>
        </div>
      </section>
    </main>
  </div>

  <script>
  // ----- CONFIG -----
  const PX_PER_INCH = 30; // visual scale. Increase for more resolution.
  const STORAGE_KEY = "signDesignerState_v1";

  const SIGN_SIZES = {
    "12x6": { widthIn: 12, heightIn: 6, label: '12" × 6"' },
    "18x9": { widthIn: 18, heightIn: 9, label: '18" × 9"' },
    "24x12": { widthIn: 24, heightIn: 12, label: '24" × 12"' },
    "36x18": { widthIn: 36, heightIn: 18, label: '36" × 18"' }
  };

  // ----- FABRIC SETUP -----
  const canvasElement = document.getElementById("design-canvas");
  const canvas = new fabric.Canvas(canvasElement, {
    preserveObjectStacking: true,
    selection: true
  });

  const signSizeSelect = document.getElementById("sign-size");
  const canvasLabel = document.getElementById("canvas-label");
  const addTextBtn = document.getElementById("add-text-btn");
  const textInput = document.getElementById("text-input");
  const resetBtn = document.getElementById("reset-canvas");
  const downloadBtn = document.getElementById("download-png");

  let currentSizeKey = "24x12";

  // ----- SIZE / CANVAS -----
  function setSignSize(sizeKey) {
  const size = SIGN_SIZES[sizeKey];
  if (!size) return;

  currentSizeKey = sizeKey;
  const pxWidth = size.widthIn * PX_PER_INCH;
  const pxHeight = size.heightIn * PX_PER_INCH;

  // Set Fabric's internal canvas size
  canvas.setWidth(pxWidth);
  canvas.setHeight(pxHeight);

  // Make sure the DOM element matches exactly
  canvasElement.width = pxWidth;
  canvasElement.height = pxHeight;
  canvasElement.style.width = pxWidth + "px";
  canvasElement.style.height = pxHeight + "px";

  canvas.calcOffset();
  canvas.requestRenderAll();

  canvasLabel.textContent = `${size.label} • ${pxWidth} × ${pxHeight} px (preview scale)`;
}


  function resetCanvas() {
    canvas.clear();
    canvas.setBackgroundColor("#ffffff", () => canvas.renderAll());
    localStorage.removeItem(STORAGE_KEY);
  }

  // ----- LOCAL STORAGE (SAVE / LOAD) -----
  function saveState() {
    try {
      const json = canvas.toJSON();
      const data = {
        canvas: json,
        sizeKey: currentSizeKey
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    } catch (e) {
      console.warn("Could not save state:", e);
    }
  }

  function loadStateOrInit() {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (raw) {
      try {
        const data = JSON.parse(raw);
        const sizeKey = data.sizeKey || currentSizeKey;
        setSignSize(sizeKey);

        canvas.loadFromJSON(data.canvas, () => {
          canvas.renderAll();
        });
        currentSizeKey = sizeKey;
        signSizeSelect.value = sizeKey;
        return;
      } catch (e) {
        console.warn("Could not load saved state, starting fresh:", e);
      }
    }

    // No saved state, start with a clean canvas
    resetCanvas();
    setSignSize(currentSizeKey);
  }

  // ----- TEXT HANDLING -----
  function addText() {
  const value = textInput.value.trim() || "Your text here";
  const size = SIGN_SIZES[currentSizeKey];

  const text = new fabric.IText(value, {
    fontSize: Math.max(20, size.heightIn * 4),
    fontFamily: "-apple-system, BlinkMacSystemFont, 'SF Pro Text', system-ui",
    fill: "#111111",
    originX: "center",
    originY: "center"
  });

  canvas.add(text);

  // Center the text using Fabric's helper (uses current canvas size)
  canvas.centerObject(text);
  text.setCoords();

  canvas.setActiveObject(text);
  canvas.requestRenderAll();

  saveState?.(); // if saveState exists in your script; otherwise remove this line
}


  // ----- DOWNLOAD PNG -----
  function downloadPNG() {
    if (!canvas.getObjects().length) {
      alert("Add some text or graphics before downloading a preview.");
      return;
    }

    const dataUrl = canvas.toDataURL({
      format: "png",
      quality: 1
    });

    const link = document.createElement("a");
    link.href = dataUrl;
    link.download = `sign-preview-${currentSizeKey}.png`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  // ----- EVENT BINDINGS -----
  signSizeSelect.addEventListener("change", (e) => {
    setSignSize(e.target.value);
    saveState();
  });

  addTextBtn.addEventListener("click", addText);

  resetBtn.addEventListener("click", () => {
    if (confirm("Clear the sign and start over?")) {
      resetCanvas();
      setSignSize(currentSizeKey);
    }
  });

  downloadBtn.addEventListener("click", downloadPNG);

  // Autosave when user edits objects on the canvas
  canvas.on("object:modified", saveState);
  canvas.on("object:added", saveState);
  canvas.on("object:removed", saveState);

  // ----- INITIALIZE -----
  loadStateOrInit();
  </script>

</body>
</html>

